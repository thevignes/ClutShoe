<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Document</title>
</head>

<body>


  <!-- <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/sweetalert2@10/dist/sweetalert2.min.css"/> -->
  <%- include("../../views/partial/admin/header") %>
    <link rel="stylesheet" href="/evara-backend/assets/css/vendors/category.css">
    <!-- SweetAlert2 CSS -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/sweetalert2@11/dist/sweetalert2.min.css">

    <!-- SweetAlert2 JavaScript -->
    


    <style>
      .col-md-3 {
        padding: 20px;
        border: 1px solid #ddd;
        border-radius: 10px;
        margin: 10px;
      }

      .form-label {
        margin-bottom: 8px;
      }

      .form-control {
        width: 100%;
        padding: 8px;
        margin-bottom: 10px;
        border: 1px solid #ccc;
        border-radius: 5px;
        box-sizing: border-box;
      }

      .d-grid {
        margin-top: 20px;
      }

      .btn-primary {
        background-color: #007bff;
        color: #fff;
        border: 1px solid #007bff;
        border-radius: 5px;
        padding: 10px 20px;
        cursor: pointer;
      }

      .btn-primary:hover {
        background-color: #0056b3;
        border-color: #0056b3;
      }

      .pagination-container {
        text-align: center;
      }

      .pagination {
        display: inline-block;
      }

      .pagination a,
      .pagination .current-page {
        display: inline-block;
        padding: 5px 10px;
        margin: 0 2px;
        border: 1px solid #ddd;
        text-decoration: none;
        color: #333;
      }

      .pagination a:hover {
        background-color: #f5f5f5;
      }

      .error-message {
        color: red;
      }

      .pagination-container {
        display: flex;
        justify-content: center;
        align-items: center;
        margin-top: 20px;
        gap: 10px;
        padding: 10px;
        border: 1px solid #ddd;
        border-radius: 8px;
        background-color: #f9f9f9;
      }

      .pagination-container a,
      .pagination-container .current-page {
        display: inline-block;
        padding: 8px 12px;
        margin: 0 2px;
        text-decoration: none;
        color: #333;
        border: 1px solid #ddd;
        border-radius: 4px;
        transition: background-color 0.3s, color 0.3s;
      }

      .pagination-container a:hover {
        background-color: #007bff;
        color: #fff;
        border-color: #007bff;
      }

      .pagination-container .current-page {
        font-weight: bold;
        color: #fff;
        background-color: #007bff;
        border-color: #007bff;
      }

      .pagination-container a:disabled,
      .pagination-container a[disabled] {
        pointer-events: none;
        color: #bbb;
        border-color: #ccc;
        background-color: #e9e9e9;
      }
    </style>
    </head>

    <body>
      <section class="content-main">
        <div class="content-header">
          <div>
            <h2 class="content-title card-title">Category</h2>
          </div>
        </div>
        <header class="card-header text-center mb-20">
          <form action="/admin/category" method="get" class="d-inline">
            <div class="input-group input-group-sm border border-1 border-grey rounded-pill"
              style="width: 500px; margin-left: 230px">
              <input type="text" class="form-control border-0 rounded-pill mt-3" placeholder="Search categories"
                name="search">
              <button class="btn" type="submit">Search</button>
            </div>
          </form>
        </header>
        <div class="card">
          <div class="card-body">
            <div class="row">
              <div class="col-md-3">
                <form method="post" action="/admin/addCategory" onsubmit="return validateForm();">
                  <div class="mb-4">
                    <label for="product_name" class="form-label">Name</label>
                    <input type="text" id="name" name="name" placeholder="Type here" class="form-control" id="product_name">
                    <div id="name-error" class="error-message"></div>
                  </div>
                  <div class="mb-4">
                    <label class="form-label">Description</label>
                    <textarea placeholder="Type here" id="description" name="description" class="form-control"
                      id="descriptionId"></textarea>
                    <div id="description-error" class="error-message"></div>
                  </div>
                  <div class="d-grid">
                    <button class="btn btn-primary" type="submit">
                      Create category
                    </button>
                  </div>
                </form>


              </div>

              <!-- Category table -->
              <div class="col-md-8 ml-10">
                <div class="table-responsive">
                  <table class="table table-hover">
                    <thead>
                      <tr>
                        <th class="text-center"></th>
                        <th>Name</th>
                        <th>Description</th>
                        <th>Offer Price</th>
                        <th>Offer</th>
                        <th>Status</th>
                        <th>List/Unlist</th>
                        <th class="text-start">Edit</th>
                      </tr>
                    </thead>
                    <tbody>
                      <% cate.forEach(function(Category) { %>
                        <tr>
                          <td></td>
                          <td class="text-start">
                            <%= Category.name %>
                          </td>
                          <td class="text-start">
                            <%= Category.description %>
                          </td>
                          <td>
                            <%= Category.offerPrice %>
                          </td>
                          <td class="text-start">
                            <form action="">
                              <a href="#" class="btn btn-info text-white mb-2" style="width: 100px; font-size:11px">Add
                                Offer</a>
                            </form>

                            <form action="/admin/CategoryDelete/<%=  Category._id %>?_method=PUT" method="POST"
                              class="mt-3">
                              <button type="submit" class="btn btn-danger "
                                onclick="return confirm('Are you sure you want to delete this category?');"
                                style="font-size: 11px;">Delete Category</button>
                            </form>
                          </td>
                          <td class="text-start">
                            <% if (Category.isListed) { %>
                              <span class="badge rounded-pill alert-success" style="width: 60px">Listed</span>
                              <% } else { %>
                                <span class="badge rounded-pill alert-danger" style="width: 60px">Unlisted</span>
                                <% } %>
                          </td>
                          <td class="text-start">
                            <% if (Category.isListed) { %>
                              <form action="/admin/UnCategoryList/<%= Category._id %>" method="POST"
                                style="display: inline;">
                                <button type="submit" class="btn btn-danger text-white"
                                  style="width: 70px">Unlist</button>
                                <% } else { %>
                                  <form action="/admin/CategoryList/<%= Category._id %>" method="POST"
                                    style="display: inline;">
                                    <button type="submit" class="btn btn-success text-white"
                                      style="width: 70px">List</button>
                                    <% } %>
                          </td>
                          <td class="text-start">

                            <a href="/admin/editCategory/<%= Category._id %>" class="btn btn-info text-white">Edit</a>
                          </td>
                        </tr>
                        <% }); %>
                    </tbody>
                  </table>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- Pagination -->
        <div class="pagination-container">
          <% if (CurrentPage> 1) { %>
            <a href="?page=<%= CurrentPage - 1 %>&limit=<%= limit %>">
            <% } %>

              <!-- Page numbers -->
              <% for (let i=1; i <=TotalPages; i++) { %>
                <% if (i===CurrentPage) { %>
                  <span class="current-page">
                    <%= i %>
                  </span>
                  <% } else { %>
                    <a href="?page=<%= i %>&limit=<%= limit %>">
                      <%= i %>
                    </a>
                    <% } %>
                      <% } %>

                        <% if (CurrentPage < TotalPages) { %>
                          <a href="?page=<%= CurrentPage + 1 %>&limit=<%= limit %>">
                          <% } %>
        </div>


      </section>
    </body>
    <!-- SweetAlert2 CDN -->
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>


<script>
  document.addEventListener('DOMContentLoaded', () => {
  const form = document.querySelector('form');
  form.addEventListener('submit', (e) => {
  e.preventDefault();

    // Fetch form input values
    const name = document.getElementById('name').value;
    const description = document.getElementById('description').value;

    // Perform AJAX call using jQuery
    $.ajax({
      method: 'POST',
      url: '/admin/addCategory',
      data: {
        name: name,
        description: description
      },
      success: (response) => {
  console.log(response); // Log the response to check its structure
  if (response.success) { // Check for success property instead of status
    Swal.fire({
      icon: 'success',
      title: 'Category Added',
      text: response.message,
      toast: true,
      position: 'top-end',
      showConfirmButton: false,
      timer: 3000
    });
  } else {
    Swal.fire({
      icon: 'error',
      title: 'Category Already Exists',
      text: response.error || 'An error occurred while adding the category.',
      toast: true,
      position: 'top-end',
      showConfirmButton: false,
      timer: 3000
    });
  }
},
      error: (error) => {
        Swal.fire({
          icon: 'error',
          title: 'Something went wrong',
          text: 'An error occurred while adding the category.',
          toast: true,
          position: 'top-end',
          showConfirmButton: false,
          timer: 3000
        });
      }
    });
  });
});

</script>




</html>
<%- include("../../views/partial/admin/footer") %>